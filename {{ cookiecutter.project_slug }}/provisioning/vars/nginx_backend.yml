---
{% raw %}
nginx_remove_default_vhost: yes

nginx_upstreams:
  - name: backend_app
    strategy: least_conn
    servers:
      - "127.0.0.1:8080 fail_timeout=0"

nginx_vhosts:
  - listen: "80"
    server_name: "localhost"
    nginx_error_log: "/var/log/nginx/backend_app_error.log warn"
    nginx_access_log: "/var/log/nginx/backend_app_access.log main buffer=16k"
    state: "present"
    filename: "backend_app.conf"
    extra_parameters: |
      location / {
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
          proxy_set_header Host $http_host;
          proxy_redirect off;
          proxy_pass http://backend_app;
      }
{% endraw %}