---
{% raw %}
nginx_remove_default_vhost: yes

nginx_upstreams:
  - name: backend_app
    strategy: least_conn
    servers:
      - "127.0.0.1:8080 fail_timeout=0"

nginx_vhosts:
  # catch-all configuration to validate the 'Host' HTTP header. A request which does
  # not match the specified 'server_name' will be returned a 404 response. See
  # https://docs.djangoproject.com/en/2.2/howto/deployment/checklist/#allowed-hosts
  # for more.
  - listen: "80 default_server"
    server_name: "_"
    return: "404"
  - listen: "80"
    server_name: "{{ backend_server_name }}"
    state: "present"
    filename: "backend_app.conf"
    extra_parameters: |
      location / {
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
          proxy_set_header Host $http_host;
          proxy_redirect off;
          proxy_pass http://backend_app;
      }

      location /static {
          alias {{ static_root }};
      }
{% endraw %}